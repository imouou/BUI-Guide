<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>src/scripts/mix/web/bui.upload.js - BUI</title>
    <!-- <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css"> -->
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="../assets/css/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/js/jquery-1.9.1.min.js"></script>
</head>

<body class="yui3-skin-sam">
    <div id="sidemenu" class="sidebar-menu">菜单</div>
    <div id="doc">
        <div id="hd" class="yui3-g header" style="display: none;">
            <div class="yui3-u-3-4">
                <h1><a href="../index.html"><img src="../assets/css/logo.png"
                            title="BUI" width="30px"></a>
                    <a href="../index.html">BUI</a>
                </h1>
                <p class="off-left">其它版本:<select name="" id="" onchange="window.open(this.value)">
                        <option value="../api/index.html" selected>1.8.x</option>
                        <option value="../api-1.7.x/index.html">1.7.x</option>
                        <option value="../api-1.6.x/index.html">1.6.x</option>
                        <option value="../api-1.5.x/index.html">1.5.x</option>
                        <option value="../api-1.4.8/index.html">1.4.x</option>
                    </select></p>
                <p class="off-left" style="font-size:12px;margin-right: 15px;">API for BUI
                    1.8.x </p>

            </div>
        </div>
        <div id="bd" class="yui3-g" style="padding-top: 0;">
            <div id="sidebar" class="yui3-u-1-4" style="top:0;">

                <a href="../index.html"
                    style="display: block;padding:6px;font-size:16px;background:#fff;position:absolute;z-index:1000;width:70px;letter-spacing:2px;text-align:right;left:220px;top:20px;color:#333;">返回</a>

                <div id="docs-sidebar" class="sidebar apidocs">
                    <div id="api-list">
                        <div id="api-tabview" class="tabview">
                    
                            <ul class="tabs">
                                <li><a href="#api-classes">Classes</a></li>
                                <li><a href="#api-modules">Modules</a></li>
                            </ul>
                    
                            <div id="api-tabview-filter">
                                <input type="search" id="api-filter" placeholder="Type to filter APIs">
                            </div>
                    
                            <div id="api-tabview-panel">
                                <ul id="api-classes" class="apis classes">
                                    <li><a href="../classes/bui.accordion.html">bui.accordion</a></li>
                                    <li><a href="../classes/bui.actionsheet.html">bui.actionsheet</a></li>
                                    <li><a href="../classes/bui.ajax.html">bui.ajax</a></li>
                                    <li><a href="../classes/bui.alert.html">bui.alert</a></li>
                                    <li><a href="../classes/bui.all.html">bui.all</a></li>
                                    <li><a href="../classes/bui.animate.html">bui.animate</a></li>
                                    <li><a href="../classes/bui.array.html">bui.array</a></li>
                                    <li><a href="../classes/bui.back.html">bui.back</a></li>
                                    <li><a href="../classes/bui.btn.html">bui.btn</a></li>
                                    <li><a href="../classes/bui.checkVersion.html">bui.checkVersion</a></li>
                                    <li><a href="../classes/bui.cmd.html">bui.cmd</a></li>
                                    <li><a href="../classes/bui.config.html">bui.config</a></li>
                                    <li><a href="../classes/bui.confirm.html">bui.confirm</a></li>
                                    <li><a href="../classes/bui.date.html">bui.date</a></li>
                                    <li><a href="../classes/bui.delete.html">bui.delete</a></li>
                                    <li><a href="../classes/bui.dialog.html">bui.dialog</a></li>
                                    <li><a href="../classes/bui.download.html">bui.download</a></li>
                                    <li><a href="../classes/bui.dropdown.html">bui.dropdown</a></li>
                                    <li><a href="../classes/bui.emitter.html">bui.emitter</a></li>
                                    <li><a href="../classes/bui.extend.html">bui.extend</a></li>
                                    <li><a href="../classes/bui.file.html">bui.file</a></li>
                                    <li><a href="../classes/bui.fileselect.html">bui.fileselect</a></li>
                                    <li><a href="../classes/bui.floor.html">bui.floor</a></li>
                                    <li><a href="../classes/bui.get.html">bui.get</a></li>
                                    <li><a href="../classes/bui.getPageParams.html">bui.getPageParams</a></li>
                                    <li><a href="../classes/bui.guid.html">bui.guid</a></li>
                                    <li><a href="../classes/bui.hint.html">bui.hint</a></li>
                                    <li><a href="../classes/bui.history.html">bui.history</a></li>
                                    <li><a href="../classes/bui.init.html">bui.init</a></li>
                                    <li><a href="../classes/bui.input.html">bui.input</a></li>
                                    <li><a href="../classes/bui.levelselect.html">bui.levelselect</a></li>
                                    <li><a href="../classes/bui.list.html">bui.list</a></li>
                                    <li><a href="../classes/bui.listview.html">bui.listview</a></li>
                                    <li><a href="../classes/bui.load.html">bui.load</a></li>
                                    <li><a href="../classes/bui.loader.html">bui.loader</a></li>
                                    <li><a href="../classes/bui.loading.html">bui.loading</a></li>
                                    <li><a href="../classes/bui.mask.html">bui.mask</a></li>
                                    <li><a href="../classes/bui.number.html">bui.number</a></li>
                                    <li><a href="../classes/bui.page.html">bui.page</a></li>
                                    <li><a href="../classes/bui.pickerdate.html">bui.pickerdate</a></li>
                                    <li><a href="../classes/bui.platform.html">bui.platform</a></li>
                                    <li><a href="../classes/bui.popover.html">bui.popover</a></li>
                                    <li><a href="../classes/bui.post.html">bui.post</a></li>
                                    <li><a href="../classes/bui.prompt.html">bui.prompt</a></li>
                                    <li><a href="../classes/bui.pullrefresh.html">bui.pullrefresh</a></li>
                                    <li><a href="../classes/bui.put.html">bui.put</a></li>
                                    <li><a href="../classes/bui.rating.html">bui.rating</a></li>
                                    <li><a href="../classes/bui.ready.html">bui.ready</a></li>
                                    <li><a href="../classes/bui.refresh.html">bui.refresh</a></li>
                                    <li><a href="../classes/bui.router.html">bui.router</a></li>
                                    <li><a href="../classes/bui.run.html">bui.run</a></li>
                                    <li><a href="../classes/bui.scroll.html">bui.scroll</a></li>
                                    <li><a href="../classes/bui.searchbar.html">bui.searchbar</a></li>
                                    <li><a href="../classes/bui.select.html">bui.select</a></li>
                                    <li><a href="../classes/bui.setting.html">bui.setting</a></li>
                                    <li><a href="../classes/bui.sidebar.html">bui.sidebar</a></li>
                                    <li><a href="../classes/bui.slide.html">bui.slide</a></li>
                                    <li><a href="../classes/bui.stepbar.html">bui.stepbar</a></li>
                                    <li><a href="../classes/bui.storage.html">bui.storage</a></li>
                                    <li><a href="../classes/bui.store.html">bui.store</a></li>
                                    <li><a href="../classes/bui.swipe.html">bui.swipe</a></li>
                                    <li><a href="../classes/bui.tab.html">bui.tab</a></li>
                                    <li><a href="../classes/bui.timer.html">bui.timer</a></li>
                                    <li><a href="../classes/bui.toggle.html">bui.toggle</a></li>
                                    <li><a href="../classes/bui.touch.html">bui.touch</a></li>
                                    <li><a href="../classes/bui.typeof.html">bui.typeof</a></li>
                                    <li><a href="../classes/bui.unit.html">bui.unit</a></li>
                                    <li><a href="../classes/bui.upload.html">bui.upload</a></li>
                                    <li><a href="../classes/bui.viewport.html">bui.viewport</a></li>
                                </ul>
                    
                                <ul id="api-modules" class="apis modules">
                                    <li><a href="../modules/Animate.html">Animate</a></li>
                                    <li><a href="../modules/Core.html">Core</a></li>
                                    <li><a href="../modules/Event.html">Event</a></li>
                                    <li><a href="../modules/Method.html">Method</a></li>
                                    <li><a href="../modules/Native.html">Native</a></li>
                                    <li><a href="../modules/UI.html">UI</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <script>
                        // iframe 里执行脚本，通过引入index.js 的方式无法成功
                        function sidebarInit() {
                            var sidebarHeight = $(window).height() - 153;
                    
                            $("#api-tabview-panel").height(sidebarHeight);
                        }
                        sidebarInit();
                    </script>                </div>
            </div>
            <div class="yui3-u-3-4">
                    <div id="api-options">
                        Show:
                        <label for="api-show-inherited">
                            <input type="checkbox" id="api-show-inherited" checked>
                            Inherited
                        </label>
                
                        <label for="api-show-protected">
                            <input type="checkbox" id="api-show-protected">
                            Protected
                        </label>
                
                        <label for="api-show-private">
                            <input type="checkbox" id="api-show-private">
                            Private
                        </label>
                        <label for="api-show-deprecated">
                            <input type="checkbox" id="api-show-deprecated">
                            Deprecated
                        </label>
                
                    </div>
                
                <div class="apidocs">
                    <div id="docs-main">
                        <div class="content">
                            <h1 class="file-heading">File: src/scripts/mix/web/bui.upload.js</h1>
                            
                            <div class="file">
                                <pre class="code prettyprint linenums">
                            /**
                             * @module Native
                             */
                            ;
                            (function (ui, $) {
                            
                                /**
                                 * &lt;h3&gt;单文件上传,支持webapp跟安卓,ios,&lt;del&gt;依赖于fileselect控件, 1.5.1开始,默认使用web上传,切换原生,需要更改needNative参数&lt;/del&gt; 注意: BUI 1.7开始将废弃掉该原生接口, 请使用对应的原生平台抛出的方法使用 &lt;/h3&gt;
                                 *  &lt;h3&gt;预览地址: &lt;a href=&quot;http://www.easybui.com/demo/index.html#pages/ui_controls/bui.upload.html&quot; target=&quot;_blank&quot;&gt;demo&lt;/a&gt;&lt;/h3&gt;
                                 * &lt;p&gt;选择,上传图片,只支持单个文件上传&lt;/p&gt;
                                 * {{#crossLink &quot;bui.upload/add&quot;}}{{/crossLink}}: 添加文件 &lt;br&gt;
                                 * {{#crossLink &quot;bui.upload/remove&quot;}}{{/crossLink}}: 移除添加的文件 &lt;br&gt;
                                 * {{#crossLink &quot;bui.upload/clear&quot;}}{{/crossLink}}: 清除所有添加的文件 &lt;br&gt;
                                 * {{#crossLink &quot;bui.upload/data&quot;}}{{/crossLink}}: 获取添加的数据 &lt;br&gt;
                                 * {{#crossLink &quot;bui.upload/start&quot;}}{{/crossLink}}: 上传文件 &lt;br&gt;
                                 * {{#crossLink &quot;bui.upload/stop&quot;}}{{/crossLink}}: 停止上传 &lt;br&gt;
                                 * {{#crossLink &quot;bui.upload/toBase64&quot;}}{{/crossLink}}: 把路径转换成base64位图片地址 &lt;br&gt;
                                 * {{#crossLink &quot;bui.upload/widget&quot;}}{{/crossLink}}: 获取依赖的控件 &lt;br&gt;
                                 *  @namespace bui
                                 *  @class upload
                                 *  @constructor
                                 *  @param {object} [option]
                                 *  @param {string} [option.url]  上传的地址 
                                 *  @param {object} [option.headers]  头部参数, 原生不支持 
                                 *  @param {object} [option.method]  默认: &quot;POST&quot;,
                                 *  @param {object} [option.data]  要上传的对象, data初始化的时候有值会直接上传, 使用 h5 的formdata 上传 
                                 *  @param {string} [option.fileKey]  默认: file , 后端需要接收这个字段进行保存 
                                 *  @param {number} [option.timeout]  触发timeout的时间默认60000 
                                 *  @param {string} [option.mediaType]  1.4.7新增, 文件的类型, 原生只支持图片上传,webapp部分机型不支持 默认: picture | allmedia  | video | audio ｜ application/zip
                                 *  @param {string} [option.from]  1.4.7新增, 默认 &quot;&quot; 从相册选 | &quot;camera&quot; 相机拍照 | &quot;camcorder&quot; 录像, 需要配合 mediaType  参数 
                                 *  @param {boolean} [option.showProgress]  是否显示进度条 默认true  
                                 *  @param {boolean} [option.native]  1.5.1废弃,由needNative决定 &lt;del&gt;默认true 由bui.isWebapp状态决定 false则强制采用web方式&lt;/del&gt; 
                                 *  @param {boolean} [option.needNative]  1.5.1新增, 是否使用原生上传, 不受bui.isWebapp状态决定 默认 false|true 通过这个切换对应的效果,可以通过全局配置 bui.config.upload = {needNative:true} 
                                 *  @param {function} [option.onProgress]  自定义进度条回调,接收百分比值 
                                 *  @param {function} [option.onSuccess]  成功的回调 
                                 *  @param {boolean} [option.autoClose]  1.5新增, 是否允许关闭进度条 
                                 *  @param {function} [option.onMask]  1.5新增, 点击默认进度条的回调,默认停止上传并关闭显示 
                                 *  @param {function} [option.onFail]  失败的回调 
                                 *  @param {function} [option.currentName]  1.5.2新增,获取当前选择的文件名称,常用于配合删除 
                                 *  @param {function} [option.currentIndex]  1.5.2新增,获取当前选择的文件索引,常用于配合删除 
                                 *  @example
                                 *
                                 *   html:
                                 * 
                                    &lt;div id=&quot;buiPhoto&quot; class=&quot;bui-upload bui-fluid-space-4&quot;&gt;
                                        &lt;div class=&quot;span1&quot;&gt;
                                            &lt;div id=&quot;btnUpload&quot; class=&quot;bui-btn&quot;&gt;
                                                &lt;i class=&quot;icon-plus large&quot;&gt;&lt;/i&gt;
                                            &lt;/div&gt;
                                        &lt;/div&gt;
                                    &lt;/div&gt;
                            
                                 *   js:
                                 *
                                        // 1. 初始化 这里如果传url初始化,则url作为公共上传地址,start不再需要传url
                                        var uiUpload = bui.upload({
                                            url: &quot;http://&quot;
                                        });
                            
                                        // 2. 选择文件
                            
                                        $(&quot;#btnUpload&quot;).click(function(){
                                            uiUpload.add({
                                                onSuccess: function(file){
                                                    
                                                    // 3. 上传文件 选择以后直接上传到服务器
                                                     uiUpload.start({
                                                         data: {
                                                             file: file
                                                          },
                                                         onSuccess:function(res){
                                                             // 展示返回的图片
                                                            $(&quot;#buiPhoto&quot;).append(&#x60;&lt;div class=&quot;span1&quot;&gt;&lt;img src=&quot;${res.url}&quot; /&gt;&lt;/div&gt;&#x60;)
                                                         },
                                                         onFail: function(res,status){
                                                             // 失败 status = &quot;timeout&quot; || &quot;error&quot; || &quot;abort&quot;, &quot;parsererror&quot;
                                                         }
                                                     });
                                                }
                                            })
                                        })
                                        
                            
                                        
                                 *
                                 */
                                ui.upload = function (option) {
                                    var config = {
                                        uid: &quot;&quot;,
                                        url: &quot;&quot;,
                                        data: null,
                                        headers: {},
                                        showProgress: true,
                                        timeout: 60000,
                                        contentType: false,
                                        processData: false,
                                        autoClose: true,
                                        multiple: false,
                                        native: true,
                                        name: &quot;uploadFiles&quot;,
                                        needNative: false, // 不使用native
                                        method: &quot;POST&quot;,
                                        fileKey: &quot;file&quot;,
                                        dataType: &quot;json&quot;,
                                        mediaType: &quot;picture&quot;, // picture | video | audio | allmedia
                                        from: &quot;picture&quot;,
                                        onProgress: null,
                                        onMask: function () {
                                            stop();
                                        },
                                        onSuccess: null,
                                        onFail: null
                                    }
                            
                                    var options = $.extend(true, {}, config, ui.config.upload, option);
                                    //延时处理
                                    var def = $.Deferred();
                                    var module = {
                                        init: init,
                                        add: add,
                                        addMore: addMore,
                                        remove: remove,
                                        resize: resize,
                                        currentIndex: currentIndex,
                                        currentName: currentName,
                                        clear: clear,
                                        data: data,
                                        start: start,
                                        startAll: startAll,
                                        stop: stop,
                                        toBase64: toBase64,
                                        widget: widget
                                    };
                            
                            
                                    var uiLoading,
                                        uiSelect,
                                        uiAjax,
                                        uiNativeUpload,
                                        //fileData 是一个对象 document.getElementById(&#x27;fileToUpload&#x27;).files
                                        fileData,
                                        uploadUrl,
                                        // 是否显示进度条
                                        showProgress = options.showProgress,
                                        //对进度条单独处理
                                        onProgress = options.onProgress,
                                        // 如果没有传 needNative 以 isWebapp 的状态为主
                                        webapp = typeof option === &quot;object&quot; &amp;&amp; typeof option.needNative !== &quot;undefined&quot; ? !option.needNative : ui.isWebapp, //(options.native &amp;&amp; ui.isWebapp) || (!options.native &amp;&amp; !ui.isWebapp),
                                        id,
                                        guid,
                                        $btnFile,
                                        progressPercent;
                                    // 初始化
                                    init(options);
                            
                                    function init(opt) {
                            
                                        // 实例化进度条
                                        uiLoading = ui.loading({
                                            // display: &quot;block&quot;,
                                            display: &quot;block&quot;,
                                            width: 30,
                                            height: 30,
                                            opacity: 0,
                                            autoClose: opt.autoClose,
                                            callback: opt.onMask
                                        });
                                        // 实例化选择器
                                        uiSelect = ui.fileselect.call(module, {
                                            native: opt.native,
                                            needNative: opt.needNative,
                                            from: opt.from,
                                            name: opt.name,
                                            multiple: opt.multiple,
                                            mediaType: opt.mediaType,
                                            onChange: opt.onChange,
                                        })
                            
                                        module.el = uiSelect.el;
                            
                                        if (opt &amp;&amp; opt.needNative) {
                                            uiNativeUpload = ui.native.upload &amp;&amp; ui.native.upload(opt, {
                                                loading: uiLoading,
                                                fileselect: uiSelect,
                                                module: module
                                            }) || {};
                                        }
                                        if (!opt.data) {
                                            return this;
                                        }
                            
                                        //上传
                                        start(opt);
                            
                            
                                        // 存储实例
                                        opt.uid &amp;&amp; ui.history.setUI &amp;&amp; ui.history.setUI({
                                            uid: opt.uid,
                                            ui: module
                                        })
                            
                                        return this;
                            
                                    }
                            
                                    /**
                                     * 修改图片大小
                                     *  @method resize
                                     *  @since 1.5.3
                                     *  @param {object} [option]  对象 
                                     *  @param {object} [option.data]  图片的值, 不传则拿最后选择的文件 
                                     *  @param {number} [option.quality]  图片质量,默认0.8 
                                     *  @param {number} [option.width] 图片宽度,默认800, targetWidth和targetHeight设置为undefined 则添加原图
                                     *  @param {number} [option.height] 图片高度,默认800, targetWidth和targetHeight设置为undefined 则添加原图
                                     *  @param {boolean} [option.needCompress]  是否需要压缩, 默认: false | true 
                                     *  @param {string} [option.destinationType]  file (返回路径值) | data (返回base64位值) | blob(返回文件流) 
                                     *  @param {function} [option.onSuccess]  成功的回调 
                                     *  @param {function} [option.onFail]  失败的回调 
                                     *  @chainable
                                     *  @example
                                     *
                                        uiFileSelect.resize({
                                            data: uiFileSelect.data(),
                                            width:100,
                                            needCompress:true,
                                            onSuccess: function(file){
                                                // this 指向uiFileSelect
                                                // console.log(this)
                                            }
                                        })
                            
                                     */
                                    function resize(param) {
                            
                                        uiSelect.resize(param);
                            
                                        return this;
                                    }
                                    /**
                                     * 添加文件
                                     *  @method add
                                     *  @param {object} [option] 图片质量,默认0.8
                                     *  @param {boolean} [option.needCompress]  1.5.3新增 是否需要压缩, 默认 false | true , true 以下的质量及宽度高度参数才会有效.
                                     *  @param {number} [option.quality] 图片质量,默认0.8
                                     *  @param {number} [option.width] 图片宽度,默认800, targetWidth和targetHeight设置为undefined 则添加原图
                                     *  @param {number} [option.height] 图片高度,默认800, targetWidth和targetHeight设置为undefined 则添加原图
                                     *  @param {string} [option.mediaType]  文件的类型, picture | video | allmedia 原生只支持图片上传   
                                     *  @param {string} [option.from]  1.4.7新增, 默认 &quot;&quot; 从相册选 | &quot;camera&quot; 相机拍照 | &quot;camcorder&quot; 录像, 需要配合 mediaType  参数 原生: 默认来自 photo(相册) | camera(相机) | savephoto(来自保存的相册) 
                                     *  @param {string} [option.destinationType]  file (返回路径值) | data (返回base64位值) 
                                     *  @param {function} [option.onChange]  改变时触发 
                                     *  @param {function} [option.onSuccess]  成功的回调 
                                     *  @param {function} [option.onFail]  失败的回调 
                                     *  @chainable
                                     *  @example
                                     *
                                        uiUpload.add({
                                            onChange: function(e){
                                                if( e.target.files.length &gt; 1){
                                                    bui.hint(&quot;一次只能选择一张图片&quot;)
                                                    // 不执行onSuccess
                                                    return false;
                                                }
                                            },
                                            onSuccess: function(file){
                                                // console.log(this)
                                            }
                                        })
                            
                                     */
                                    function add(param) {
                            
                                        param.onChange = param.onChange ? param.onChange.bind(module) : null;
                                        param.onSuccess = param.onSuccess ? param.onSuccess.bind(module) : null;
                                        param.onFail = param.onFail ? param.onFail.bind(module) : null;
                                        uiSelect.add(param);
                            
                                        return this;
                                    }
                            
                                    /**
                                     * 添加多个图片
                                     *  @method addMore
                                     *  @since 1.8.4
                                     *  @param {object} [option] 图片质量,默认0.8
                                     *  @param {boolean} [option.needCompress]  1.5.3新增 是否需要压缩, 默认 false | true , true 以下的质量及宽度高度参数才会有效.
                                     *  @param {number} [option.quality] 图片质量,默认0.8
                                     *  @param {number} [option.width] 图片宽度,默认800, targetWidth和targetHeight设置为undefined 则添加原图
                                     *  @param {number} [option.height] 图片高度,默认800, targetWidth和targetHeight设置为undefined 则添加原图
                                     *  @param {string} [option.mediaType]  文件的类型, picture | video | allmedia 原生只支持图片上传   
                                     *  @param {string} [option.from]  1.4.7新增, 默认 &quot;&quot; 从相册选 | &quot;camera&quot; 相机拍照 | &quot;camcorder&quot; 录像, 需要配合 mediaType  参数 原生: 默认来自 photo(相册) | camera(相机) | savephoto(来自保存的相册) 
                                     *  @param {string} [option.destinationType]  file (返回路径值) | data (返回base64位值) 
                                     *  @param {function} [option.onChange]  改变时触发 
                                     *  @param {function} [option.onSuccess]  成功的回调 
                                     *  @param {function} [option.onFail]  失败的回调 
                                     *  @chainable
                                     *  @example
                                     *
                                        uiUpload.addMore({
                                            onChange: function(e){
                                                if( e.target.files.length &gt; 1){
                                                    bui.hint(&quot;一次只能选择一张图片&quot;)
                                                    // 不执行onSuccess
                                                    return false;
                                                }
                                            },
                                            onSuccess: function(file){
                                                // console.log(this)
                                            }
                                        })
                            
                                     */
                                    function addMore(param) {
                            
                                        param.onChange = param.onChange ? param.onChange.bind(module) : null;
                                        param.onSuccess = param.onSuccess ? param.onSuccess.bind(module) : null;
                                        param.onFail = param.onFail ? param.onFail.bind(module) : null;
                                        uiSelect.addMore(param);
                            
                                        return this;
                                    }
                            
                                    /**
                                     * 删除某个文件,支持索引,图片名称,需要先把 currentIndex,currentName 之类的存在选择后的图片上,供删除调用, 建议拿索引去比对, 因为原生选择的图片默认都命名为 resize.jpg 所以不方便通过名称删除.
                                     *  @method remove
                                     *  @since 1.5.2
                                     *  @param {string} [name] 图片索引|图片名称
                                     *  @chainable
                                     *  @example
                                     *
                                        uiUpload.remove();
                            
                                     */
                                    function remove(name, key) {
                                        var uploadData = data();
                                        var length = uploadData.length;
                            
                                        if (length &lt; 1) {
                                            return this;
                                        }
                                        // 如果是数字,数字有包含点都是字符串
                                        if (/\d+/.test(name) &amp;&amp; String(name).indexOf(&quot;.&quot;) &lt; 0) {
                                            uiSelect.remove(uploadData[name][&quot;name&quot;], key);
                                        } else if (typeof name === &quot;string&quot;) {
                                            uiSelect.remove(name, key);
                                        } else {
                                            uiSelect.remove(uploadData[length - 1][&quot;name&quot;], key);
                                        }
                            
                                        return this;
                                    }
                            
                                    /**
                                     * 清空所有选择的文件
                                     *  @method clear
                                     *  @chainable
                                     *  @example
                                     *
                                        uiUpload.clear();
                            
                                     */
                                    function clear() {
                            
                                        uiSelect.clear();
                                        return this;
                                    }
                                    /**
                                     * 把选择的图片文件转换成base64地址,可以直接展示在页面上
                                     *  @method toBase64
                                     *  @param {object} [option] 
                                     *  @param {string} [option.data]  通过文件选择的返回值,如果不传data,值来自于通过add添加的最后一个文件  
                                     *  @param {boolean} [option.needCompress]  1.5.1新增,转换成base64以后需要压缩吗 默认 false | true , 为true, mimeType 类型才有效 
                                     *  @param {string} [option.mimeType]  1.5.1新增,转换的图片类型 默认为原图片类型 &quot;image/jpeg&quot; | &quot;image/png&quot;
                                     *  @param {function} [option.onSuccess] 成功的回调
                                     *  @param {function} [option.onFail] 失败的回调
                                     *  @chainable
                                     *  @example
                                     *
                                        uiUpload.toBase64({
                                            onSuccess: function (imgurl) {
                                                $(&quot;#id&quot;).append(&#x27;&lt;img src=&quot;&#x27;+imgurl+&#x27;&quot; /&gt;&#x27;)
                                            }
                                        });
                            
                                     */
                                    function toBase64(param) {
                                        uiSelect.toBase64(param);
                                        return this;
                                    }
                                    /**
                                     * 获取所有选择的文件, 原生默认只返回最后一个选择的文件
                                     *  @method data
                                     *  @example
                                     *
                                        var data = uiUpload.data();
                                        // 返回 [{ name: &quot;base64.jpg&quot;, data: null, type: &quot;jpg&quot; }]
                                        // 其中 data为要上传的文件值
                            
                                     */
                                    function data() {
                                        return uiSelect.data();
                                    }
                            
                                    /**
                                     * 开始上传，如果是多选的图片，接口要支持多文件上传，uiUpload.data() 包含文件和文件信息，可能还需要二次处理，不支持多文件上传可以调用 startAll 会把选择的图片多次上传。
                                     *  @method start
                                     *  @param {object} [option] 参数同初始化一样,在初始化时配置,则是公共的, data不传则获取最后一次选择
                                     *  @param {string} [option.url] 上传的地址, 默认可以在bui.upload 初始化的时候配置就不用再传
                                     *  @param {string} [option.headers]  附加在headers的参数 
                                     *  @param {string} [option.fileKey]  默认: file, 上传的图片后端要接收哪个字段 
                                     *  @param {object} [option.data]  默认不传,会上传最后一张选择的图片, 还可以添加上传的附加参数,如果需要自己指定某一张图片,可以使用 {file: null}, file为默认的图片字段,需要和fileKey保持一致. 
                                     *  @param {function} [option.onSuccess]  上传成功的回调 
                                     *  @param {function} [option.onFail]  上传失败的回调 
                                     *  @chainable
                                     *  @example
                                     *
                                        
                                        1. 单文件上传示例：
                                        
                                        uiUpload.start({
                                            url: &quot;https://&quot;,
                                            data: null,
                                            onSuccess: function (res) {
                                                // 成功
                                            },
                                            onFail: function (res,status) {
                                                // 失败 status = &quot;timeout&quot; || &quot;error&quot; || &quot;abort&quot;, &quot;parsererror&quot;
                                            }
                                        })
                            
                                        2. 接口支持多文件上传示例：1.8.4新增
                            
                                        let files = [];
                                        let data = uiUpload.data();
                            
                                        data.forEach((item,index)=&gt;{
                                            // file文件字段
                                            files.push(item.data)
                                        })
                            
                                        uiUpload.start({
                                            url: &quot;https://&quot;,
                                            data: {
                                                file: files
                                            },
                                            onSuccess: function (res) {
                                                // 成功
                                            },
                                            onFail: function (res,status) {
                                                // 失败 status = &quot;timeout&quot; || &quot;error&quot; || &quot;abort&quot;, &quot;parsererror&quot;
                                            }
                                        })
                            
                                        3. 接口不支持多文件上传，可以使用 startAll 多次上传接口
                            
                                     */
                                    function start(param) {
                            
                                        var params = $.extend(true, {}, options, param);
                            
                                        uploadUrl = params.url;
                            
                                        // 获取文件
                                        fileData = uiSelect.value();
                            
                                        showProgress = params.showProgress;
                            
                                        if (!fileData) {
                                            return;
                                        }
                            
                                        showProgress &amp;&amp; uiLoading.show();
                            
                                        if (params &amp;&amp; params.needNative) {
                            
                                            // 原生的上传
                                            return uiNativeUpload.start(params) || def;
                            
                                        } else {
                            
                                            var datas = params.data;
                            
                                            var keys = (datas &amp;&amp; typeof datas === &quot;object&quot;) ? Object.keys(datas) : [];
                            
                                            var fd = new FormData();
                            
                                            // 用户新增的参数
                                            var hasFile = false;
                                            keys.forEach(function (item, index) {
                                                // 如果有相同键名,删除默认
                                                if (params.fileKey === item) {
                                                    // fd.delete(item)
                                                    hasFile = true;
                                                }
                                                fd.append(item, datas[item]);
                                            });
                                            // 阿里云的文件上传不能是 file作为第一个参数.
                                            // 没有文件则增加默认值
                                            !hasFile &amp;&amp; fd.append(params.fileKey, fileData);
                            
                                            // for (var key in datas) {
                                            //     // 如果有相同键名,删除默认
                                            //     if (params.fileKey === key) {
                                            //         fd.delete(key)
                                            //     }
                                            //     fd.append(key, datas[key]);
                                            // }
                                            params.data = fd;
                            
                                            // web上传
                                            return webAjax(params);
                                        }
                                        return this;
                                    }
                            
                                    /**
                                     * 分批上传, 一次传一个文件的方式，会有多个请求
                                     *  @method startAll
                                     *  @param {object} [option] 参数同初始化一样,在初始化时配置,则是公共的
                                     *  @param {string} [option.url] 上传的地址, 默认可以在bui.upload 初始化的时候配置就不用再传
                                     *  @param {string} [option.headers]  附加在headers的参数 
                                     *  @param {string} [option.fileKey]  默认: file, 上传的图片后端要接收哪个字段 
                                     *  @param {object} [option.data]  默认不传,会上传所有图片, 还可以添加上传的附加参数,如果需要自己指定图片,可以使用 {file: uiUpload.data()}, file为默认的图片字段,值是数组,需要和fileKey保持一致. 
                                     *  @param {boolean} [option.needFileinfo]  1.5.3新增 默认:false | true . 把选择的图片的相关信息一起传给接口, name,size,type 
                                     *  @param {function} [option.onSuccess]  上传成功的回调 
                                     *  @param {function} [option.onFail]  上传失败的回调 
                                     *  @param {function} [option.onEnd]  1.6.2 全部上传成功或失败都会触发 
                                     *  @chainable
                                     *  @example
                                     *
                                        uiUpload.startAll({
                                            url: &quot;http://&quot;,
                                            onSuccess: function (res) {
                                                // 成功
                                            },
                                            onFail: function (res,status) {
                                                // 失败 status = &quot;timeout&quot; || &quot;error&quot; || &quot;abort&quot;, &quot;parsererror&quot;
                                            }
                                        })
                            
                                     */
                                    function startAll(param) {
                                        var params = $.extend(true, {
                                            needFileinfo: false
                                        }, options, param);
                                        var datas = params[params.fileKey] || uiSelect.data();
                                        if (!params.data) {
                                            params.data = {};
                                        }
                                        let allres = [];
                                        for (let i = 0; i &lt; datas.length; i++) {
                                            let item = datas[i];
                                            (function createSource(n) {
                            
                                                if (n &gt; datas.length - 1) {
                                                    return;
                                                }
                            
                                                params.data[params.fileKey] = datas[n] &amp;&amp; datas[n][&quot;data&quot;];
                            
                                                if (params.needFileinfo) {
                                                    // 把文件里面的信息也一起传过去后台
                                                    for (var fileKey in datas[n]) {
                                                        if (fileKey !== &quot;data&quot;) {
                                                            params.data[fileKey] = datas[n] &amp;&amp; datas[n][fileKey];
                                                        }
                                                    }
                                                }
                                                var onSuccess = params.onSuccess;
                                                var onFail = params.onFail;
                                                params.onSuccess = function (res) {
                                                    // createSource(n + 1);
                                                    onSuccess &amp;&amp; onSuccess.call(module, res);
                                                    allres[n] = res;
                                                    if (n == datas.length - 1) {
                                                        params.onEnd &amp;&amp; params.onEnd.call(module, allres);
                                                    }
                                                }
                                                params.onFail = function (res) {
                                                    // createSource(n + 1);
                                                    onFail &amp;&amp; onFail.call(module, res);
                            
                                                    allres[n] = res;
                                                    if (n == datas.length - 1) {
                                                        params.onEnd &amp;&amp; params.onEnd.call(module, allres);
                                                    }
                                                }
                            
                                                // 执行加载
                                                start(params)
                            
                                            })(i);
                                        }
                                        // datas.forEach(function(item, i) {
                                        //     (function(n) {
                                        //         params.data[params.fileKey] = datas[n][&quot;data&quot;];
                            
                                        //         if (params.needFileinfo) {
                                        //             // 把文件里面的信息也一起传过去后台
                                        //             for (var fileKey in datas[n]) {
                                        //                 if (fileKey !== &quot;data&quot;) {
                                        //                     params.data[fileKey] = datas[n][fileKey];
                                        //                 }
                                        //             }
                                        //         }
                            
                                        //         start(params);
                                        //     })(i)
                                        // })
                                        return def;
                                    }
                            
                                    /**
                                     * 停止上传
                                     *  @method stop
                                     *  @chainable
                                     *  @example
                                     *
                                        uiUpload.stop()
                            
                                     */
                                    function stop(callback) {
                                        if (options &amp;&amp; options.needNative) {
                                            // 原生的上传
                                            uiNativeUpload.stop(callback);
                            
                                        } else {
                                            uiLoading &amp;&amp; uiLoading.stop();
                                            uiAjax &amp;&amp; uiAjax.abort();
                            
                                            callback &amp;&amp; callback.call(module, uiLoading, uiAjax);
                                        }
                            
                            
                                        return this;
                            
                                    }
                            
                            
                                    // web上传
                                    function webAjax(param) {
                            
                                        // 重置参数
                                        // param.cache = false;
                                        // 必须false才会避开jQuery对 formdata 的默认处理
                                        // param.contentType = false;
                                        // 必须false才会自动加上正确的Content-Type
                                        // param.processData = false;
                                        // param.method = &quot;POST&quot;;
                            
                                        var onSuccess = param.onSuccess;
                                        var onFail = param.onFail;
                            
                                        uiAjax = $.ajax({
                                            url: uploadUrl,
                                            type: param.method,
                                            data: param.data,
                                            cache: param.cache,
                                            headers: param.headers,
                                            dataType: param.dataType,
                                            contentType: param.contentType, //不可缺
                                            processData: param.processData, //不可缺
                                            timeout: param.timeout,
                                            xhr: function () {
                                                var xhr = $.ajaxSettings.xhr();
                            
                                                // 处理上传的进度
                            
                                                if (uploadProgress &amp;&amp; xhr.upload) {
                                                    xhr.upload.addEventListener(&quot;progress&quot;, uploadProgress, false);
                                                    return xhr;
                                                }
                                            },
                                            success: function (result) {
                                                stopLoading();
                                                onSuccess &amp;&amp; onSuccess.call(module, result);
                                                def.resolve(result);
                                            },
                                            error: function (result, status, xhr) {
                                                stopLoading();
                                                onFail &amp;&amp; onFail.call(module, result, status);
                                                def.reject(result, status, xhr);
                                            }
                                        });
                            
                                        return def;
                            
                                    }
                            
                                    // web 上传进度
                                    function uploadProgress(evt) {
                                        //安卓4.3以下不支持
                                        window.requestAnimationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame;
                            
                                        // 防止掉帧
                                        window.requestAnimationFrame(function () {
                                            if (evt.lengthComputable) {
                            
                                                var percentComplete = Math.round(evt.loaded * 100 / evt.total);
                                                progressPercent = percentComplete.toString() + &#x27;%&#x27;;
                            
                                                if (percentComplete &lt; 100) {
                                                    startLoading(progressPercent)
                                                } else {
                                                    stopLoading();
                                                }
                                                // 原生进度
                                                // navigator.notification.progressValue(Math.round(( progressEvt.loaded / progressEvt.total ) * 100));
                            
                                                onProgress &amp;&amp; onProgress.call(module, progressPercent);
                                            }
                                        })
                            
                                    }
                            
                                    // 开启进度
                                    function startLoading(percent) {
                                        showProgress &amp;&amp; uiLoading &amp;&amp; uiLoading.show({
                                            text: percent
                                        });
                            
                                        return this;
                            
                                    }
                            
                                    // 关闭进度
                                    function stopLoading() {
                                        uiLoading &amp;&amp; uiLoading.stop();
                            
                                        return this;
                            
                                    }
                            
                                    /**
                                     * 获取最后选择的文件名,删除的时候
                                     *  @method currentName
                                     *  @since 1.5.2
                                     *  @example
                                     *
                                        var currentName = uiUpload.currentName();
                            
                                     */
                                    function currentName() {
                            
                                        var n = uiSelect.currentName();
                                        return n;
                                    }
                                    /**
                                     * 获取最后选择的文件名,删除的时候
                                     *  @method currentIndex
                                     *  @since 1.5.2
                                     *  @example
                                     *
                                        var currentIndex = uiUpload.currentIndex();
                            
                                     */
                                    function currentIndex() {
                                        var n = uiSelect.currentIndex();
                                        return n;
                                    }
                            
                                    /**
                                     * 获取依赖的控件
                                     *  @method widget
                                     *  @param {string} [name]  依赖控件名 loading 
                                     *  @example
                            
                                        //获取依赖控件
                                        var uiLoading = uiUpload.widget(&quot;loading&quot;);
                            
                                        //使用uiLoading的方法
                                        uiLoading.start();
                            
                                     */
                                    function widget(name) {
                                        var control = {
                                            loading: uiLoading,
                                            fileselect: uiSelect,
                                            ajax: uiAjax
                                        };
                                        return ui.widget.call(control, name);
                                    };
                            
                                    return module;
                                };
                            
                                return ui;
                            
                            })(window.bui || {}, window.libs);
                                </pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../assets/js/index.js"></script>
    <script src="../assets/js/yui-min.js"></script>
    <script src="../assets/js/combo/oop-min.js"></script>
    <script src="../assets/js/combo/array-extras-min.js"></script>
    <script src="../assets/js/combo/autocomplete.js"></script>
    <script src="../assets/js/combo/history-base-min.js"></script>
    <script src="../assets/vendor/prettify/prettify-min.js"></script>
    <script>prettyPrint();</script>
    <script src="../assets/js/yui-prettify.js"></script>
    <script src="../assets/../api.js"></script>
    <script src="../assets/js/api-filter.js"></script>
    <script src="../assets/js/api-list.js"></script>
    <script src="../assets/js/api-search.js"></script>
    <script src="../assets/js/apidocs.js"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            var analytics_bd = '6781b936303667306495d5d92ad58add';
            hm.src = ['ht', 't', 'ps', ':/', '/h', 'm', '.', 'ba', 'i', 'd', 'u.c', 'o', 'm/', 'h', 'm', '.j', 's?', analytics_bd].join('');
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</body>

</html>