<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>src/scripts/core/bui.viewport.js - BUI</title>
    <!-- <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css"> -->
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="../assets/css/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/js/jquery-1.9.1.min.js"></script>
</head>

<body class="yui3-skin-sam">
    <div id="sidemenu" class="sidebar-menu">菜单</div>
    <div id="doc">
        <div id="hd" class="yui3-g header" style="display: none;">
            <div class="yui3-u-3-4">
                <h1><a href="../index.html"><img src="../assets/css/logo.png"
                            title="BUI" width="30px"></a>
                    <a href="../index.html">BUI</a>
                </h1>
                <p class="off-left">其它版本:<select name="" id="" onchange="window.open(this.value)">
                        <option value="../api/index.html" selected>1.8.x</option>
                        <option value="../api-1.7.x/index.html">1.7.x</option>
                        <option value="../api-1.6.x/index.html">1.6.x</option>
                        <option value="../api-1.5.x/index.html">1.5.x</option>
                        <option value="../api-1.4.8/index.html">1.4.x</option>
                    </select></p>
                <p class="off-left" style="font-size:12px;margin-right: 15px;">API for BUI
                    1.8.x </p>

            </div>
        </div>
        <div id="bd" class="yui3-g" style="padding-top: 0;">
            <div id="sidebar" class="yui3-u-1-4" style="top:0;">

                <a href="../index.html"
                    style="display: block;padding:6px;font-size:16px;background:#fff;position:absolute;z-index:1000;width:70px;letter-spacing:2px;text-align:right;left:220px;top:20px;color:#333;">返回</a>

                <div id="docs-sidebar" class="sidebar apidocs">
                    <div id="api-list">
                        <div id="api-tabview" class="tabview">
                    
                            <ul class="tabs">
                                <li><a href="#api-classes">Classes</a></li>
                                <li><a href="#api-modules">Modules</a></li>
                            </ul>
                    
                            <div id="api-tabview-filter">
                                <input type="search" id="api-filter" placeholder="Type to filter APIs">
                            </div>
                    
                            <div id="api-tabview-panel">
                                <ul id="api-classes" class="apis classes">
                                    <li><a href="../classes/bui.accordion.html">bui.accordion</a></li>
                                    <li><a href="../classes/bui.actionsheet.html">bui.actionsheet</a></li>
                                    <li><a href="../classes/bui.ajax.html">bui.ajax</a></li>
                                    <li><a href="../classes/bui.alert.html">bui.alert</a></li>
                                    <li><a href="../classes/bui.all.html">bui.all</a></li>
                                    <li><a href="../classes/bui.animate.html">bui.animate</a></li>
                                    <li><a href="../classes/bui.array.html">bui.array</a></li>
                                    <li><a href="../classes/bui.back.html">bui.back</a></li>
                                    <li><a href="../classes/bui.btn.html">bui.btn</a></li>
                                    <li><a href="../classes/bui.checkVersion.html">bui.checkVersion</a></li>
                                    <li><a href="../classes/bui.cmd.html">bui.cmd</a></li>
                                    <li><a href="../classes/bui.config.html">bui.config</a></li>
                                    <li><a href="../classes/bui.confirm.html">bui.confirm</a></li>
                                    <li><a href="../classes/bui.date.html">bui.date</a></li>
                                    <li><a href="../classes/bui.delete.html">bui.delete</a></li>
                                    <li><a href="../classes/bui.dialog.html">bui.dialog</a></li>
                                    <li><a href="../classes/bui.download.html">bui.download</a></li>
                                    <li><a href="../classes/bui.dropdown.html">bui.dropdown</a></li>
                                    <li><a href="../classes/bui.emitter.html">bui.emitter</a></li>
                                    <li><a href="../classes/bui.extend.html">bui.extend</a></li>
                                    <li><a href="../classes/bui.file.html">bui.file</a></li>
                                    <li><a href="../classes/bui.fileselect.html">bui.fileselect</a></li>
                                    <li><a href="../classes/bui.floor.html">bui.floor</a></li>
                                    <li><a href="../classes/bui.get.html">bui.get</a></li>
                                    <li><a href="../classes/bui.getPageParams.html">bui.getPageParams</a></li>
                                    <li><a href="../classes/bui.guid.html">bui.guid</a></li>
                                    <li><a href="../classes/bui.hint.html">bui.hint</a></li>
                                    <li><a href="../classes/bui.history.html">bui.history</a></li>
                                    <li><a href="../classes/bui.init.html">bui.init</a></li>
                                    <li><a href="../classes/bui.input.html">bui.input</a></li>
                                    <li><a href="../classes/bui.levelselect.html">bui.levelselect</a></li>
                                    <li><a href="../classes/bui.list.html">bui.list</a></li>
                                    <li><a href="../classes/bui.listview.html">bui.listview</a></li>
                                    <li><a href="../classes/bui.load.html">bui.load</a></li>
                                    <li><a href="../classes/bui.loader.html">bui.loader</a></li>
                                    <li><a href="../classes/bui.loading.html">bui.loading</a></li>
                                    <li><a href="../classes/bui.mask.html">bui.mask</a></li>
                                    <li><a href="../classes/bui.number.html">bui.number</a></li>
                                    <li><a href="../classes/bui.page.html">bui.page</a></li>
                                    <li><a href="../classes/bui.pickerdate.html">bui.pickerdate</a></li>
                                    <li><a href="../classes/bui.platform.html">bui.platform</a></li>
                                    <li><a href="../classes/bui.popover.html">bui.popover</a></li>
                                    <li><a href="../classes/bui.post.html">bui.post</a></li>
                                    <li><a href="../classes/bui.prompt.html">bui.prompt</a></li>
                                    <li><a href="../classes/bui.pullrefresh.html">bui.pullrefresh</a></li>
                                    <li><a href="../classes/bui.put.html">bui.put</a></li>
                                    <li><a href="../classes/bui.rating.html">bui.rating</a></li>
                                    <li><a href="../classes/bui.ready.html">bui.ready</a></li>
                                    <li><a href="../classes/bui.refresh.html">bui.refresh</a></li>
                                    <li><a href="../classes/bui.router.html">bui.router</a></li>
                                    <li><a href="../classes/bui.run.html">bui.run</a></li>
                                    <li><a href="../classes/bui.scroll.html">bui.scroll</a></li>
                                    <li><a href="../classes/bui.searchbar.html">bui.searchbar</a></li>
                                    <li><a href="../classes/bui.select.html">bui.select</a></li>
                                    <li><a href="../classes/bui.setting.html">bui.setting</a></li>
                                    <li><a href="../classes/bui.sidebar.html">bui.sidebar</a></li>
                                    <li><a href="../classes/bui.slide.html">bui.slide</a></li>
                                    <li><a href="../classes/bui.stepbar.html">bui.stepbar</a></li>
                                    <li><a href="../classes/bui.storage.html">bui.storage</a></li>
                                    <li><a href="../classes/bui.store.html">bui.store</a></li>
                                    <li><a href="../classes/bui.swipe.html">bui.swipe</a></li>
                                    <li><a href="../classes/bui.tab.html">bui.tab</a></li>
                                    <li><a href="../classes/bui.timer.html">bui.timer</a></li>
                                    <li><a href="../classes/bui.toggle.html">bui.toggle</a></li>
                                    <li><a href="../classes/bui.touch.html">bui.touch</a></li>
                                    <li><a href="../classes/bui.typeof.html">bui.typeof</a></li>
                                    <li><a href="../classes/bui.unit.html">bui.unit</a></li>
                                    <li><a href="../classes/bui.upload.html">bui.upload</a></li>
                                    <li><a href="../classes/bui.viewport.html">bui.viewport</a></li>
                                </ul>
                    
                                <ul id="api-modules" class="apis modules">
                                    <li><a href="../modules/Animate.html">Animate</a></li>
                                    <li><a href="../modules/Core.html">Core</a></li>
                                    <li><a href="../modules/Event.html">Event</a></li>
                                    <li><a href="../modules/Method.html">Method</a></li>
                                    <li><a href="../modules/Native.html">Native</a></li>
                                    <li><a href="../modules/UI.html">UI</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <script>
                        // iframe 里执行脚本，通过引入index.js 的方式无法成功
                        function sidebarInit() {
                            var sidebarHeight = $(window).height() - 153;
                    
                            $("#api-tabview-panel").height(sidebarHeight);
                        }
                        sidebarInit();
                    </script>                </div>
            </div>
            <div class="yui3-u-3-4">
                    <div id="api-options">
                        Show:
                        <label for="api-show-inherited">
                            <input type="checkbox" id="api-show-inherited" checked>
                            Inherited
                        </label>
                
                        <label for="api-show-protected">
                            <input type="checkbox" id="api-show-protected">
                            Protected
                        </label>
                
                        <label for="api-show-private">
                            <input type="checkbox" id="api-show-private">
                            Private
                        </label>
                        <label for="api-show-deprecated">
                            <input type="checkbox" id="api-show-deprecated">
                            Deprecated
                        </label>
                
                    </div>
                
                <div class="apidocs">
                    <div id="docs-main">
                        <div class="content">
                            <h1 class="file-heading">File: src/scripts/core/bui.viewport.js</h1>
                            
                            <div class="file">
                                <pre class="code prettyprint linenums">
                            /**
                             * 核心
                             * @module Core
                             */
                            
                            ;
                            (function (ui, $) {
                            
                            
                                /**
                                 * 默认引入BUI.js就会初始化整个视图缩放.
                                 * 用于修改页面缩放比例,默认字体大小100px,手机端的字体大小大概在76px;
                                 * 整个缩放是基于540视图处理.
                                 * @namespace bui
                                 * @class  viewport
                                 * @constructor
                                 * @param  {boolean|number|object} opt [ true（脚本计算，默认由样式处理，但如果某些新机型无法适配，可以使用 &#x60;bui.viewport(true)&#x60; ） | 固定数字 | {
                                 *      width: &quot;device-width&quot;,
                                        initScale: 1, // 初始比例
                                        maxScale: 1, // 最大缩放比例
                                        minScale: 1, // 最小缩放比例
                                        fit: &quot;cover&quot;, // cover ｜ auto | contain
                                        scalable: &quot;no&quot;, // yes
                                        size: 50,    // 固定大小   
                                        create: false   // true 则会修改 meta[name=viewport] 的content,false则默认不改
                                    } ]
                                 * @example
                                 *
                                     bui.ready(function(){
                                         
                                         //1. 强制根据不同屏幕动态计算适合的比例
                                         window.viewport = bui.viewport(true);
                                         
                                         //2. 强制页面固定比例显示
                                         window.viewport = bui.viewport(50);
                            
                                         //3. 允许缩放
                                         window.viewport = bui.viewport({
                                             maxScale: 2,
                                             scalable: &quot;yes&quot;,
                                             create: true
                                         });
                                     })
                                 *
                                 */
                            
                                function view(opts, base) {
                                    // opts 可以是 true | 具体数字 ｜ 对象
                                    ui.trigger.call(ui, &quot;viewportbefore&quot;);
                            
                                    var config = $.extend(true, {
                                        uid: &quot;&quot;,
                                        width: &quot;device-width&quot;,
                                        initScale: 1, // 初始比例
                                        maxScale: 1, // 最大缩放比例
                                        minScale: 1, // 最小缩放比例
                                        fit: &quot;cover&quot;, // cover
                                        scalable: &quot;no&quot;, // yes
                                        zoom: true,
                                        hd: true,   // 高清屏幕加上一点修补，不然容易显得字体偏小
                                        base: 750,
                                        size: 0,
                                        create: false
                                    }, ui.config.viewport);
                            
                                    var opt = typeof opts == &quot;object&quot; ? $.extend(true, config, opts) : config;
                            
                                    var win = window.parent === window ? window : window.top;
                            
                                    var size,
                                        metaEl = document.querySelector(&quot;meta[name=viewport]&quot;),
                            
                                        // viewport = &#x60;&quot;width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no,viewport-fit=cover&quot;&#x60;,
                                        viewport = &#x60;&quot;width=${opt.width}, initial-scale=${opt.initScale}, maximum-scale=${opt.maxScale}, minimum-scale=${opt.minScale}, user-scalable=${opt.scalable},viewport-fit=${opt.fit}&quot;&#x60;,
                                        ratio = window.devicePixelRatio,
                                        winWid = win.document.documentElement.clientWidth || win.innerWidth,
                                        winHei = win.document.documentElement.clientHeight || win.innerHeight,
                                        winWidth = parseInt(winWid) * parseInt(ratio),
                                        winHeight = parseInt(winHei) * parseInt(ratio);
                            
                                    let cacheWinWidth = winWid;
                                    let cacheWinHeight = winHei;
                                    // 处理横屏 高度加上信号条的高度 winHei iphone6的部分oa里面，获取高度第一次会为0
                                    winWid = (winWid &gt; winHei &amp;&amp; winHei &gt; 1) ? (winHei + 24) : winWid;
                            
                            
                                    if (typeof opts === &quot;number&quot;) {
                                        opt.size = opts;
                                    } else {
                                        // 100 为字体的缩放 20px = 0.2rem;
                                        opt.size = opt.size || (winWid / opt.base * 100).toFixed(2); // 大于0 则采用传进来的字体大小，否则自动计算
                                    }
                                    //是否需要动态创建viewport
                                    if (!metaEl) {
                            
                                        var element = document.createElement(&#x27;meta&#x27;);
                                        element.name = &quot;viewport&quot;;
                                        element.content = viewport;
                                        var head = document.head;
                                        head.appendChild(element);
                                        element = null;
                                    } else {
                                        opt.create &amp;&amp; (metaEl.content = viewport);
                                    }
                            
                            
                                    // 已经做过适配的设备宽度 基于540  ,534,854为华为pad w09 , 小米 mix3 2.75 393 816
                                    var device = [240, 320, 360, 375, 384, 393, 412, 414, 435, 480, 512, 540, 768, 1024, 1080, 1536, 2048, 2732, 534, 854, 750];
                                    var deviceSize = [32, 42.67, 48, 50, 51.2, 52.4, 54.93, 55.2, 58, 64, 68.27, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60];
                                    var index = ui.array.index(device, win.document.documentElement.clientWidth);
                                    // var deviation = opt.hd ? (ratio &gt; 2 ? (ratio - 2) * 10 : 0) : 0;
                            
                                    // 没传参数时,并且分辨率已经存在时,不做处理,可以更快, LINK 的新版容器不支持@media写法，统一采用计算的形式
                                    if (index &gt; -1 &amp;&amp; typeof opts === &quot;undefined&quot;) {
                                        // 是否已经全局适配,通过样式设置
                                        size = deviceSize[index];
                            
                                    } else {
                                        // 初始化
                                        init(opt);
                                    }
                            
                                    var module = {
                                        width: getWidth,
                                        height: getHeight,
                                        fontSize: size,
                                        screenWidth: getScreenWidth,
                                        screenHeight: getScreenHeight,
                                        ratio: getRatio,
                                        init: init
                                    }
                            
                                    function init(option) {
                                        //计算缩放的比例
                                        var baseSize = 100, // 字体基数
                                            baseWidth = base || 750, // 设计量的尺寸
                                            domHtml = document.head.parentNode;
                            
                                        // 高清屏+10的修正公式 401ppi ratio:2.625 2.75
                                        var fontSize = typeof (option) === &quot;object&quot; ? option.size || 50 : option;
                            
                                        // 通过js动态设置
                                        size = fontSize || 50;
                            
                                        opt.zoom &amp;&amp; (domHtml.style.fontSize = size + &#x27;px&#x27;);
                            
                                        // 存储实例
                                        opt.uid &amp;&amp; ui.history.setUI &amp;&amp; ui.history.setUI({
                                            uid: opt.uid,
                                            ui: module
                                        })
                            
                                        ui.trigger.call(ui, &quot;viewportinit&quot;);
                            
                                        return this;
                                    }
                            
                                    /**
                                     * 获取视口的宽度
                                     * @method width
                                     * @example
                                     *
                                        bui.ready(function(){
                                            var width = window.viewport.width();
                                        })
                                     *
                                     */
                                    function getWidth(argument) {
                                        return cacheWinWidth || $(&quot;#bui-router&quot;).width() || $(&quot;body&quot;).width() || $(&quot;.bui-page&quot;).width();
                                    }
                            
                                    /**
                                     * 获取视口的高度
                                     * @method height
                                     * @example
                                     *
                                        bui.ready(function(){
                                            var height = window.viewport.height();
                                        })
                                     *
                                     */
                                    function getHeight(argument) {
                                        return cacheWinHeight || $(&quot;#bui-router&quot;).height() || $(&quot;body&quot;).height() || $(&quot;.bui-page&quot;).height();
                                    }
                                    /**
                                     * 获取的屏幕宽度分辨率
                                     * @method screenWidth
                                     * @example
                                     *
                                        bui.ready(function(){
                                            var width = window.viewport.screenWidth();
                                        })
                                     *
                                     */
                                    function getScreenWidth(argument) {
                                        return winWidth;
                                    }
                                    /**
                                     * 获取的屏幕高度分辨率
                                     * @method screenHeight
                                     * @example
                                     *
                                        bui.ready(function(){
                                            var height = window.viewport.screenHeight();
                                        })
                                     *
                                     */
                                    function getScreenHeight(argument) {
                                        return winHeight;
                                    }
                                    /**
                                     * 获取高清屏的dpi
                                     * @method ratio
                                     * @example
                                     *
                                        bui.ready(function(){
                                            var ratio = window.viewport.ratio();
                                        })
                                     *
                                     */
                                    function getRatio(argument) {
                                        return ratio;
                                    }
                            
                            
                                    return module
                                }
                            
                                ui.viewport = view;
                            
                            
                                return ui;
                            
                            })(window.bui || {}, window.libs);
                                </pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../assets/js/index.js"></script>
    <script src="../assets/js/yui-min.js"></script>
    <script src="../assets/js/combo/oop-min.js"></script>
    <script src="../assets/js/combo/array-extras-min.js"></script>
    <script src="../assets/js/combo/autocomplete.js"></script>
    <script src="../assets/js/combo/history-base-min.js"></script>
    <script src="../assets/vendor/prettify/prettify-min.js"></script>
    <script>prettyPrint();</script>
    <script src="../assets/js/yui-prettify.js"></script>
    <script src="../assets/../api.js"></script>
    <script src="../assets/js/api-filter.js"></script>
    <script src="../assets/js/api-list.js"></script>
    <script src="../assets/js/api-search.js"></script>
    <script src="../assets/js/apidocs.js"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            var analytics_bd = '6781b936303667306495d5d92ad58add';
            hm.src = ['ht', 't', 'ps', ':/', '/h', 'm', '.', 'ba', 'i', 'd', 'u.c', 'o', 'm/', 'h', 'm', '.j', 's?', analytics_bd].join('');
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</body>

</html>